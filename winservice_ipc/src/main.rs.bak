use std::env;

mod ipc_server;
mod winservice;

use server::{my_service_main, spawn_server_thread};
use winservice::run_windows_service;

const PIPE_NAME: &str = r"\\.\pipe\ff6f957f-3149-42b9-9215-a8b58e27369c";
const SERVICE_NAME: &str = "BetterWG Background service";

fn main() {
    let args: Vec<String> = env::args().collect();
    if args.len() >= 2 {
        match args[1].as_str() {
            "/background" => {
                run_windows_service(SERVICE_NAME, my_service_main);
            }
            "/server" => {
                spawn_server_thread(PIPE_NAME);
            }
            _ => println!("Invalid command"),
        }
    } else {
        println!("Please provide a valid command");
    }
}
